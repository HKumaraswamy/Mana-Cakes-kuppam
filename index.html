<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mana Cakes Kuppam - Home</title>
<style>
/* ... your existing CSS ... (no changes needed) ... */
</style>
</head>
<body>

<!-- Navbar -->
<nav>
  <div class="brand">
    <div class="logo">üç∞</div>
    <div>Mana Cakes Kuppam</div>
  </div>
  <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
  <ul id="navLinks">
    <li><a href="index.html">Home</a></li>
    <li><a href="menu.html">Menu</a></li>
    <li><a href="order.html">Order</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul>
  <div class="cart-icon" onclick="toggleCart()">üõí
    <span class="cart-badge" id="cartCount">0</span>
  </div>
</nav>

<!-- Hero -->
<section>
  <h2>Fresh. Creamy. Handcrafted.</h2>
  <p class="lead">Custom cakes & daily favorites baked in Kuppam. Delivery available within <b>5 km</b> of the Bus Stand.</p>
</section>

<!-- Featured Cakes -->
<section>
  <h2>Featured Cakes</h2>
  <div class="grid" id="cakesContainer"></div>
</section>

<!-- Cart Sidebar -->
<div class="cart-sidebar" id="cartSidebar">
  <h3>Your Cart</h3>
  <div id="cartItems"></div>
  <div class="cart-footer">
    <button class="btn-checkout" onclick="checkout()">Checkout</button>
  </div>
</div>

<!-- Admin Buttons -->
<div style="text-align:right; margin:10px;">
  <button onclick="adminLogin()">üë®‚Äçüç≥ Owner Login</button>
  <button id="logoutBtn" style="display:none;" onclick="adminLogout()">Logout</button>
</div>

<!-- Add Cake Form -->
<div id="addCakeForm" style="display:none; padding:20px; border:1px solid #ccc; margin:20px; border-radius:8px;">
  <h3>Add New Cake</h3>
  <label>Cake Name:</label><br>
  <input type="text" id="cakeName"><br><br>
  <label>Cake Price (‚Çπ):</label><br>
  <input type="number" id="cakePrice"><br><br>
  <label>Upload Cake Image:</label><br>
  <input type="file" id="cakeImage" accept="image/*"><br><br>
  <button onclick="saveNewCake()">Save Cake</button>
  <button onclick="document.getElementById('addCakeForm').style.display='none'">Cancel</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("manaCart")) || [];
let cakes = [];
let isAdmin = localStorage.getItem("isAdmin")==="true";

const BIN_ID = "68ada1cbd0ea881f40660f29"; 
const API_KEY = "$2a$10$qHD76TLbOL4GHnUhRFkj5ex0XAjZVH7P4KMCWvx43okgyZr5TtR3y";
const BASE_URL = "https://api.jsonbin.io/v3/b";
const whatsappNumber = "919441269096";

// --------- Cart Functions ---------
function toggleMenu(){ document.getElementById('navLinks').classList.toggle('active'); }
function toggleCart(){ document.getElementById('cartSidebar').classList.toggle('active'); }
function addToCart(name, price){ 
  let item = cart.find(c=>c.name===name);
  if(item) item.qty++;
  else cart.push({name,price,qty:1});
  saveCart();
  updateCartDisplay();
}
function removeItem(i){ cart.splice(i,1); saveCart(); updateCartDisplay(); }
function updateCartDisplay(){ 
  const cartItems = document.getElementById("cartItems");
  const cartCount = document.getElementById("cartCount");
  cartItems.innerHTML = "";
  let total=0;
  cart.forEach((item,i)=>{
    total += item.qty;
    cartItems.innerHTML += `<div class="cart-item"><span>${item.name} x${item.qty}</span><span>‚Çπ${item.price*item.qty} <button onclick="removeItem(${i})">‚ùå</button></span></div>`;
  });
  cartCount.textContent = total;
}
function saveCart(){ localStorage.setItem("manaCart",JSON.stringify(cart)); }
function checkout(){ 
  if(cart.length===0){ alert("Cart empty!"); return; }
  window.location.href="order.html?items="+encodeURIComponent(JSON.stringify(cart));
}
function buyNow(name,price){
  window.location.href="order.html?items="+encodeURIComponent(JSON.stringify([{name,price,qty:1}]));
}
function orderWhatsApp(name,price){
  const msg = `Hello! I want to order:\n- ${name} x1 = ‚Çπ${price}\nTotal: ‚Çπ${price}`;
  window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`,"_blank");
}

// --------- Admin Functions ---------
function adminLogin(){
  let pass = prompt("Enter Owner Password:");
  if(pass==="kuppam123"){
    isAdmin = true;
    localStorage.setItem("isAdmin","true");
    enableAdminUI();
    alert("Admin mode ON ‚úÖ");
  } else alert("Wrong password ‚ùå");
}
function adminLogout(){
  isAdmin = false;
  localStorage.setItem("isAdmin","false");
  disableAdminUI();
  alert("Logged out");
}
function enableAdminUI(){ document.getElementById("logoutBtn").style.display="inline-block"; reRenderCakes(); }
function disableAdminUI(){ document.getElementById("logoutBtn").style.display="none"; reRenderCakes(); }

// --------- Cake Functions ---------
function saveNewCake(){
  let name = document.getElementById("cakeName").value;
  let price = document.getElementById("cakePrice").value;
  let file = document.getElementById("cakeImage");
  if(!name || !price || isNaN(price)){ alert("Invalid details!"); return; }
  if(file.files.length===0){ alert("Select image!"); return; }
  let reader = new FileReader();
  reader.onload = function(e){
    cakes.push({name,price,img:e.target.result});
    saveCakesToServer();
    document.getElementById("addCakeForm").style.display="none";
    document.getElementById("cakeName").value="";
    document.getElementById("cakePrice").value="";
    file.value="";
  }
  reader.readAsDataURL(file.files[0]);
}

function renderCake(cake,i){
  let container=document.getElementById("cakesContainer");
  let card=document.createElement("div"); card.className="card";
  card.innerHTML=`<img class="media" src="${cake.img}" alt="${cake.name}"><div class="pad"><h3>${cake.name}</h3><div><span class="price">‚Çπ${cake.price}</span></div><div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;"><button class="btn" onclick="addToCart('${cake.name}',${cake.price})">Add to Cart</button><button class="btn secondary" onclick="buyNow('${cake.name}',${cake.price})">Buy Now</button><button class="btn success" onclick="orderWhatsApp('${cake.name}',${cake.price})">üì≤ WhatsApp</button>${isAdmin?`<button class="btn danger" onclick="deleteCake(${i})">‚ùå Delete</button>`:""}</div></div>`;
  container.appendChild(card);
}

function deleteCake(i){
  if(confirm("Delete this cake?")){
    cakes.splice(i,1);
    saveCakesToServer();
  }
}

function reRenderCakes(){
  let container=document.getElementById("cakesContainer");
  container.innerHTML="";
  cakes.forEach((c,i)=>renderCake(c,i));
  if(isAdmin){
    let add = document.createElement("div");
    add.className = "add-card";
    add.textContent = "+";
    add.onclick = ()=>document.getElementById("addCakeForm").style.display="block";
    container.appendChild(add);
  }
}

// --------- JSONBin Functions ---------
async function saveCakesToServer(){
  try{
    await fetch(`${BASE_URL}/${BIN_ID}`,{
      method:"PUT",
      headers:{
        "Content-Type":"application/json",
        "X-Master-Key":API_KEY
      },
      body: JSON.stringify(cakes)
    });
    reRenderCakes();
  }catch(e){ console.error("Error saving cakes:",e);}
}

async function loadCakesFromServer(){
  try{
    let res = await fetch(`${BASE_URL}/${BIN_ID}/latest`,{
      headers:{ "X-Master-Key": API_KEY }
    });
    let data = await res.json();
    cakes = data?.record || [];
    reRenderCakes();
  }catch(e){ console.error("Error loading cakes:",e);}
}

// --------- Init ---------
updateCartDisplay();
loadCakesFromServer();
</script>

</body>
</html>

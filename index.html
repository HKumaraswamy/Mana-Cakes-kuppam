<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mana Cakes Kuppam - Home</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fff8f9; }
  nav { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#ff4081; color:#fff; position:sticky; top:0; z-index:1000; }
  nav .brand { display:flex; align-items:center; gap:8px; font-weight:bold; font-size:20px; }
  nav .menu-toggle { display:none; cursor:pointer; font-size:22px; }
  nav ul { display:flex; list-style:none; gap:20px; margin:0; padding:0; }
  nav ul li a { color:#fff; text-decoration:none; font-weight:500; }
  nav ul.active { display:block; flex-direction:column; gap:10px; background:#ff6fa1; padding:10px; position:absolute; top:60px; right:20px; border-radius:6px; }
  .cart-icon { cursor:pointer; font-size:22px; position:relative; }
  .cart-badge { position:absolute; top:-6px; right:-10px; background:red; color:#fff; font-size:12px; border-radius:50%; padding:2px 6px; }

  section { padding:30px 20px; text-align:center; }
  section h2 { font-size:28px; color:#ff4081; margin-bottom:10px; }
  section p.lead { font-size:16px; color:#555; }

  .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:15px; margin-top:20px; }
  .card { border:1px solid #eee; border-radius:12px; overflow:hidden; background:#fff; padding:10px; display:flex; flex-direction:column; justify-content:space-between; }
  .card img.media { width:100%; height:180px; object-fit:cover; border-radius:8px; }
  .pad { padding:10px; }
  .price { font-weight:bold; color:#ff4081; }
  .btn { padding:6px 10px; border:none; border-radius:5px; cursor:pointer; background:#ff4081; color:#fff; }
  .btn.secondary { background:#f0f0f0; color:#333; }
  .btn.success { background:#25d366; color:#fff; }
  .btn.danger { background:#e53935; color:#fff; }

  .add-card { display:flex; align-items:center; justify-content:center; height:200px; border:2px dashed #bbb; border-radius:12px; font-size:50px; color:#999; cursor:pointer; transition:0.3s; }
  .add-card:hover { background:#f8f8f8; color:#ff4081; }

  .cart-sidebar { position:fixed; right:-400px; top:0; width:300px; height:100%; background:#fff; box-shadow:-2px 0 8px rgba(0,0,0,0.2); transition:0.3s; padding:20px; overflow-y:auto; z-index:999; }
  .cart-sidebar.active { right:0; }
  .cart-item { display:flex; justify-content:space-between; margin-bottom:12px; border-bottom:1px solid #eee; padding-bottom:6px; }
  .cart-footer { margin-top:15px; text-align:center; }
  .btn-checkout { background: #ff4081; color: white; border: none; padding: 10px 15px; cursor: pointer; border-radius: 5px; }

  footer { text-align:center; padding:20px; background:#ff4081; color:#fff; margin-top:30px; }

  @media(max-width:768px){ nav ul { display:none; flex-direction:column; gap:10px; } nav .menu-toggle { display:block; } }
</style>
</head>
<body>

<!-- Navbar -->
<nav>
  <div class="brand">
    <div class="logo">üç∞</div>
    <div>Mana Cakes Kuppam</div>
  </div>
  <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
  <ul id="navLinks">
    <li><a href="index.html">Home</a></li>
    <li><a href="menu.html">Menu</a></li>
    <li><a href="order.html">Order</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul>
  <div class="cart-icon" onclick="toggleCart()">üõí
    <span class="cart-badge" id="cartCount">0</span>
  </div>
</nav>

<!-- Hero -->
<section>
  <h2>Fresh. Creamy. Handcrafted.</h2>
  <p class="lead">Custom cakes & daily favorites baked in Kuppam. Delivery available within <b>5 km</b> of the Bus Stand.</p>
</section>

<!-- Featured Cakes -->
<section>
  <h2>Featured Cakes</h2>
  <div class="grid" id="cakesContainer"></div>
</section>

<!-- Cart Sidebar -->
<div class="cart-sidebar" id="cartSidebar">
  <h3>Your Cart</h3>
  <div id="cartItems"></div>
  <div class="cart-footer">
    <button class="btn-checkout" onclick="checkout()">Checkout</button>
  </div>
</div>

<!-- Admin Buttons -->
<div style="text-align:right; margin:10px;">
  <button onclick="adminLogin()">üë®‚Äçüç≥ Owner Login</button>
  <button id="logoutBtn" style="display:none;" onclick="adminLogout()">Logout</button>
</div>

<!-- Add Cake Form -->
<div id="addCakeForm" style="display:none; padding:20px; border:1px solid #ccc; margin:20px; border-radius:8px;">
  <h3>Add New Cake</h3>
  <label>Cake Name:</label><br>
  <input type="text" id="cakeName"><br><br>
  <label>Cake Price (‚Çπ):</label><br>
  <input type="number" id="cakePrice"><br><br>
  <label>Upload Cake Image:</label><br>
  <input type="file" id="cakeImage" accept="image/*"><br><br>
  <button onclick="saveNewCake()">Save Cake</button>
  <button onclick="document.getElementById('addCakeForm').style.display='none'">Cancel</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("manaCart")) || [];
let cakes = [];
let isAdmin = localStorage.getItem("isAdmin")==="true";
const BIN_ID = "68ad9640b0e23b3c068fc080";
const API_KEY = "$2a$10$qHD76TLbOL4GHnUhRFkj5ex0XAjZVH7P4KMCWvx43okgyZr5TtR3y";
const BASE_URL = "https://api.jsonbin.io/v3/b";
const whatsappNumber = "919441269096";

// ---------------- Cart ----------------
function toggleMenu(){ document.getElementById('navLinks').classList.toggle('active'); }
function toggleCart(){ document.getElementById('cartSidebar').classList.toggle('active'); }
function addToCart(name, price){ let item=cart.find(c=>c.name===name); if(item){ item.qty++; } else { cart.push({name,price,qty:1}); } saveCart(); updateCartDisplay();}
function removeItem(i){ cart.splice(i,1); saveCart(); updateCartDisplay(); }
function updateCartDisplay(){ const cartItems=document.getElementById("cartItems"); const cartCount=document.getElementById("cartCount"); if(!cartItems||!cartCount) return; cartItems.innerHTML=""; let total=0; cart.forEach((item,i)=>{ total+=item.qty; cartItems.innerHTML+=`<div class="cart-item"><span>${item.name} x${item.qty}</span><span>‚Çπ${item.price*item.qty} <button onclick="removeItem(${i})">‚ùå</button></span></div>`;}); cartCount.textContent=total; }
function saveCart(){ localStorage.setItem("manaCart",JSON.stringify(cart)); }
function checkout(){ if(cart.length===0){ alert("Cart empty!"); return;} window.location.href="order.html?items="+encodeURIComponent(JSON.stringify(cart)); }
function buyNow(name,price){ window.location.href="order.html?items="+encodeURIComponent(JSON.stringify([{name,price,qty:1}])); }
function orderWhatsApp(name,price){ const msg = `Hello! I want to order:\n- ${name} x1 = ‚Çπ${price}\nTotal: ‚Çπ${price}`; window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`,"_blank"); }

// ---------------- Admin ----------------
function adminLogin(){ let pass=prompt("Enter Owner Password:"); if(pass==="kuppam123"){ isAdmin=true; localStorage.setItem("isAdmin","true"); enableAdminUI(); alert("Admin mode ON ‚úÖ"); } else{ alert("Wrong password ‚ùå"); } }
function adminLogout(){ isAdmin=false; localStorage.setItem("isAdmin","false"); disableAdminUI(); alert("Logged out"); }
function enableAdminUI(){ document.getElementById("logoutBtn").style.display="inline-block"; reRenderCakes(); }
function disableAdminUI(){ document.getElementById("logoutBtn").style.display="none"; reRenderCakes(); }

// ---------------- Cakes ----------------
function saveNewCake(){ 
  let name=document.getElementById("cakeName").value; 
  let price=document.getElementById("cakePrice").value; 
  let file=document.getElementById("cakeImage"); 
  if(!name||!price||isNaN(price)){ alert("Invalid details!"); return; } 
  if(file.files.length===0){ alert("Select image!"); return; } 
  let reader=new FileReader(); 
  reader.onload=function(e){ cakes.push({name,price,img:e.target.result}); saveCakesToServer(); document.getElementById("addCakeForm").style.display="none"; document.getElementById("cakeName").value=""; document.getElementById("cakePrice").value=""; file.value=""; }
  reader.readAsDataURL(file.files[0]);
}

function renderCake(cake,i){ 
  let container=document.getElementById("cakesContainer"); 
  let card=document.createElement("div"); card.className="card"; 
  card.innerHTML=`<img class="media" src="${cake.img}" alt="${cake.name}"><div class="pad"><h3>${cake.name}</h3><div><span class="price">‚Çπ${cake.price}</span></div><div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;"><button class="btn" onclick="addToCart('${cake.name}',${cake.price})">Add to Cart</button><button class="btn secondary" onclick="buyNow('${cake.name}',${cake.price})">Buy Now</button><button class="btn success" onclick="orderWhatsApp('${cake.name}',${cake.price})">üì≤ WhatsApp</button>${isAdmin?`<button class="btn danger" onclick="deleteCake(${i})">‚ùå Delete</button>`:""}</div></div>`; 
  container.appendChild(card);
}

function deleteCake(i){ 
  if(confirm("Delete this cake?")){
    cakes.splice(i,1);
    saveCakesToServer(); // ‚úÖ persist to JSONBin
  }
}

function reRenderCakes(){ 
  let container=document.getElementById("cakesContainer"); 
  container.innerHTML=""; 
  cakes.forEach((c,i)=>renderCake(c,i)); 
  if(isAdmin){ 
    let add=document.createElement("div"); 
    add.className="add-card"; 
    add.textContent="+"; 
    add.onclick=()=>document.getElementById("addCakeForm").style.display="block"; 
    container.appendChild(add);
  } 
}

async function loadCakesFromServer(){ 
  try{
    let res=await fetch(`${BASE_URL}/${BIN_ID}/latest`,{headers:{"X-Master-Key":API_KEY}});
    let data=await res.json();
    cakes=data.record || [];
    reRenderCakes();
  }catch(e){ console.error("Error loading cakes:",e);}
}

async function saveCakesToServer(){ 
  try{
    await fetch(`${BASE_URL}/${BIN_ID}`,{
      method:"PUT",
      headers:{"Content-Type":"application/json","X-Master-Key":API_KEY},
      body:JSON.stringify({ record: cakes }) // ‚úÖ wrap in record for JSONBin
    });
    reRenderCakes();
  }catch(e){ console.error("Error saving cakes:",e);}
}

window.onload=()=>{ loadCakesFromServer(); updateCartDisplay(); if(isAdmin) enableAdminUI(); }
</script>

<footer>
  ¬© Mana Cakes Kuppam ‚Ä¢ Baked fresh daily <br>
  <b>Owner:</b> H. Kumaraswamy <br>
  <b>Mobile:</b> <a href="tel:+919441269096">+91 9441269096</a>
</footer>
</body>
</html>

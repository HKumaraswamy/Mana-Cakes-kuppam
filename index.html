<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mana Cakes Kuppam - Admin Panel</title>
<style>
  body { font-family: Poppins,sans-serif; background:#fff5f7; margin:0; padding:0; }
  header { background:#ff7ea5; color:white; padding:15px; text-align:center; font-size:1.5em; font-weight:bold; }
  button { background:#ff7ea5; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; transition:0.3s; }
  button:hover { background:#ff4f80; }
  #productList { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:15px; padding:20px; }
  .product { background:white; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:10px; text-align:center; position:relative; }
  .product img { width:100%; height:130px; object-fit:cover; border-radius:10px; }
  .action-btn { margin-top:5px; width:48%; }
  /* Popups */
  .popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
  .popup-content { background:white; padding:20px; border-radius:10px; width:90%; max-width:400px; text-align:center; position:relative; }
  .popup-content input { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
  .close-btn { position:absolute; top:10px; right:15px; cursor:pointer; font-weight:bold; font-size:18px; }
</style>
</head>
<body>

<header>üç∞ Mana Cakes Kuppam - Admin Panel</header>

<!-- Login Button -->
<div style="text-align:center; margin:20px;">
  <button id="loginBtn">Owner Login</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel" style="display:none;">
  <button id="addProductBtn" style="margin:20px;">Add New Product</button>
  <section id="productList"></section>
</div>

<!-- Login Popup -->
<div class="popup" id="loginPopup">
  <div class="popup-content">
    <span class="close-btn" onclick="closeLogin()">‚úñ</span>
    <h3>Owner Login</h3>
    <input type="text" id="ownerName" placeholder="Username" />
    <input type="password" id="ownerPassword" placeholder="Password" />
    <button id="loginSubmit">Login</button>
  </div>
</div>

<!-- Add/Edit Product Popup -->
<div class="popup" id="productPopup">
  <div class="popup-content">
    <span class="close-btn" onclick="closeProductPopup()">‚úñ</span>
    <h3 id="popupTitle">Add Product</h3>
    <input type="text" id="popupName" placeholder="Product Name" />
    <input type="text" id="popupPrice" placeholder="Price (‚Çπ)" />
    <input type="file" id="popupPhoto" accept="image/*" />
    <button id="saveBtn">Save</button>
  </div>
</div>

<script type="module">
  // Owner Login
  const loginBtn = document.getElementById("loginBtn");
  const loginPopup = document.getElementById("loginPopup");
  const loginSubmit = document.getElementById("loginSubmit");
  const adminPanel = document.getElementById("adminPanel");

  const correctName = "owner";      // change username
  const correctPassword = "admin123"; // change password

  loginBtn.onclick = () => loginPopup.style.display = "flex";
  function closeLogin(){ loginPopup.style.display="none"; }

  loginSubmit.onclick = () => {
    const name = document.getElementById("ownerName").value;
    const password = document.getElementById("ownerPassword").value;
    if(name===correctName && password===correctPassword){
      alert("‚úÖ Login Successful!");
      loginPopup.style.display="none";
      adminPanel.style.display="block";
    }else{
      alert("‚ùå Incorrect credentials!");
    }
  };

  // Firebase Admin Panel
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCG6vkAeA0efSZ0ANW7e4qcQkiSOe2583g",
    authDomain: "bakery-data-610dc.firebaseapp.com",
    projectId: "bakery-data-610dc",
    storageBucket: "bakery-data-610dc.firebasestorage.app",
    messagingSenderId: "373918020823",
    appId: "1:373918020823:web:d0c1a902de7fa4f4252c92",
    measurementId: "G-H4JT872JGR"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  let productsData = [], editId = null;

  const productList = document.getElementById("productList");
  const popup = document.getElementById("productPopup");
  const popupTitle = document.getElementById("popupTitle");
  const popupName = document.getElementById("popupName");
  const popupPrice = document.getElementById("popupPrice");
  const popupPhoto = document.getElementById("popupPhoto");
  const saveBtn = document.getElementById("saveBtn");
  const addProductBtn = document.getElementById("addProductBtn");

  addProductBtn.onclick = () => openProductPopup();

  function openProductPopup(product=null){
    popup.style.display="flex";
    if(product){
      popupTitle.innerText="Edit Product";
      popupName.value=product.name;
      popupPrice.value=product.price;
      editId=product.id;
    }else{
      popupTitle.innerText="Add Product";
      popupName.value="";
      popupPrice.value="";
      popupPhoto.value="";
      editId=null;
    }
  }
  function closeProductPopup(){ popup.style.display="none"; editId=null; }

  saveBtn.onclick = async () => {
    const name = popupName.value.trim();
    const price = popupPrice.value.trim();
    const file = popupPhoto.files[0];

    if(!name || !price) return alert("Fill all fields!");

    if(editId){
      const docRef = doc(db,"products",editId);
      await updateDoc(docRef,{name, price});
      if(file){
        const oldData = productsData.find(p=>p.id===editId);
        const storageRef = ref(storage,"products/"+file.name);
        await uploadBytes(storageRef,file);
        const photoURL = await getDownloadURL(storageRef);
        await updateDoc(docRef,{photo:photoURL, fileName:file.name});
        if(oldData.fileName){
          const oldRef = ref(storage,"products/"+oldData.fileName);
          await deleteObject(oldRef).catch(()=>{});
        }
      }
      alert("‚úÖ Product updated!");
    }else{
      if(!file) return alert("Select photo!");
      const storageRef = ref(storage,"products/"+file.name);
      await uploadBytes(storageRef,file);
      const photoURL = await getDownloadURL(storageRef);
      await addDoc(collection(db,"products"),{name, price, photo:photoURL, fileName:file.name});
      alert("‚úÖ Product added!");
    }
    closeProductPopup();
    loadProducts();
  };

  async function loadProducts(){
    productList.innerHTML="";
    const snap = await getDocs(collection(db,"products"));
    productsData=[];
    snap.forEach(docSnap=>{
      const data=docSnap.data();
      data.id=docSnap.id;
      productsData.push(data);
      productList.innerHTML+=`
        <div class="product">
          <img src="${data.photo}" alt="${data.name}">
          <h4>${data.name}</h4>
          <p>‚Çπ${data.price}</p>
          <button class="action-btn" onclick='openProductPopup(${JSON.stringify(data).replace(/'/g,"\\'")})'>Edit</button>
          <button class="action-btn" onclick='deleteProduct("${data.id}","${data.fileName}")'>Delete</button>
        </div>
      `;
    });
  }

  window.deleteProduct = async (id, fileName)=>{
    if(!confirm("Delete this product?")) return;
    await deleteDoc(doc(db,"products",id));
    if(fileName){
      const storageRef = ref(storage,"products/"+fileName);
      await deleteObject(storageRef).catch(()=>{});
    }
    alert("üóëÔ∏è Product deleted!");
    loadProducts();
  };

  loadProducts();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mana Cakes Kuppam - Checkout</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    h2 { text-align:center; color:#ff4081; }
    .cart-items { max-width:500px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .cart-item { display:flex; justify-content:space-between; margin-bottom:12px; }
    .cart-total { text-align:right; margin-top:10px; font-weight:bold; }
    form { max-width:500px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    input, select, textarea { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ddd; }
    button { background:#ff4081; color:#fff; border:none; padding:10px; cursor:pointer; border-radius:5px; }
    button:hover { background:#e91e63; }
    #upiLink { display:none; text-align:center; margin-top:10px; }
    #upiLink a { background:#4caf50; color:#fff; padding:8px 12px; text-decoration:none; border-radius:5px; display:inline-block; }
  </style>
</head>
<body>

  <h2>üõí Checkout</h2>

  <div class="cart-items" id="cartItemsContainer">
    <!-- Cart items populated via JS -->
  </div>

  <form id="checkoutForm">
    <input type="text" id="custName" placeholder="Your Name" required>
    <input type="tel" id="custMobile" placeholder="Mobile Number" required>
    <textarea id="custAddress" placeholder="Delivery Address"></textarea>
    <button type="button" onclick="getLocation()">üìç Use My Location</button>
    <select id="orderType">
      <option value="Pickup">Pickup</option>
      <option value="Delivery">Delivery (within 5 km)</option>
    </select>
    <input type="text" id="advance" placeholder="Advance Payment (optional)">
    <select id="paymentMode" onchange="toggleUpi()">
      <option value="Cash">Cash</option>
      <option value="UPI">UPI</option>
    </select>
    <div id="upiLink">
      <a id="upiPay" target="_blank">üí≥ Pay via UPI</a>
    </div>
    <button type="submit">Confirm Order</button>
  </form>

  <script>
    const shopLat = 12.74804;
    const shopLon = 78.3463;
    const yourNumber = "919876543210"; // replace with your WhatsApp number
    const yourUpi = "yourupiid@upi";   // replace with your UPI ID

    // Read cart items from URL
    const urlParams = new URLSearchParams(window.location.search);
    const items = JSON.parse(urlParams.get('items') || "[]");
    const cartContainer = document.getElementById("cartItemsContainer");

    let total = 0;
    if(items.length===0){
      cartContainer.innerHTML = "<p>Your cart is empty!</p>";
    } else {
      items.forEach(item=>{
        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `<span>${item.name} x${item.qty}</span><span>‚Çπ${item.price*item.qty}</span>`;
        cartContainer.appendChild(div);
        total += item.price*item.qty;
      });
      const totalDiv = document.createElement("div");
      totalDiv.className = "cart-total";
      totalDiv.textContent = "Total: ‚Çπ"+total;
      cartContainer.appendChild(totalDiv);
    }

    // GPS delivery
    function getLocation() {
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(function(pos){
          const lat=pos.coords.latitude;
          const lon=pos.coords.longitude;
          const R=6371, dLat=(lat-shopLat)*Math.PI/180, dLon=(lon-shopLon)*Math.PI/180;
          const a=Math.sin(dLat/2)**2 + Math.cos(shopLat*Math.PI/180)*Math.cos(lat*Math.PI/180)*Math.sin(dLon/2)**2;
          const dist = R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
          if(dist>5){
            alert(`‚ùå Delivery unavailable (${dist.toFixed(2)} km). Choose Pickup.`);
          } else {
            document.getElementById("custAddress").value = `https://www.google.com/maps?q=${lat},${lon}`;
            alert(`‚úÖ Within delivery range (${dist.toFixed(2)} km).`);
          }
        }, function(){ alert("‚ö†Ô∏è Could not get location. Enter address manually."); });
      } else alert("‚ö†Ô∏è Geolocation not supported.");
    }

    function toggleUpi(){
      const mode = document.getElementById("paymentMode").value;
      const upiDiv = document.getElementById("upiLink");
      if(mode==="UPI"){
        document.getElementById("upiPay").href = `upi://pay?pa=${yourUpi}&pn=ManaCakes&am=&cu=INR`;
        upiDiv.style.display="block";
      } else {
        upiDiv.style.display="none";
      }
    }

    // Submit ‚Üí WhatsApp
    document.getElementById("checkoutForm").addEventListener("submit",function(e){
      e.preventDefault();
      const name=document.getElementById("custName").value;
      const mobile=document.getElementById("custMobile").value;
      const address=document.getElementById("custAddress").value;
      const type=document.getElementById("orderType").value;
      const advance=document.getElementById("advance").value;
      const payment=document.getElementById("paymentMode").value;

      let message = `üç∞ *New Order* üç∞%0A`;
      items.forEach(i=>{ message += `*${i.name}* x${i.qty} = ‚Çπ${i.price*i.qty}%0A`; });
      message += `*Total:* ‚Çπ${total}%0A`;
      message += `*Name:* ${name}%0A*Mobile:* ${mobile}%0A*Address:* ${address}%0A*Order Type:* ${type}%0A*Advance:* ${advance}%0A*Payment:* ${payment}`;

      const whatsappURL = `https://wa.me/${yourNumber}?text=${message}`;
      window.open(whatsappURL,"_blank");
      alert("‚úÖ Order sent to WhatsApp! We‚Äôll contact you soon.");
    });
  </script>
</body>
</html>
